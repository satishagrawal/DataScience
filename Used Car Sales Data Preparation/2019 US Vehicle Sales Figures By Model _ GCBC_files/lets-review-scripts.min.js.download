/**
 * Copyright: Codetipi
 * Plugin: Let's Review
 * Version: 2.6.2
 */
!function(e){"use strict";var t={init:function(){this.cacheDom(),this.cacheData(),1===parseInt(letsReview.letsReviewUReviews)&&this.sliderLoaders(),this.bindEvents(),this.lightboxInit(),this.tooltipInit(),this.tempAni()},cacheDom:function(){this.$doc=e(document),this.$win=e(window),this.$body=e("body"),this.$tooltip=e(".lets-review-tip-f"),this.$lightbox=e(".lets-review-lightbox"),this.rtl=!!this.$body.hasClass("rtl"),this.$userRating=e('[id^="cb-user-rating-"]'),this.$formLabels=e(".lets-review-ur-onoff-label"),this.$lrForm=e(".lets-review-form"),1===parseInt(letsReview.letsReviewUReviews)&&(this.dataGather=e(".lets-review-form-crits:first").data(),this.$cSliders=e(".lets-review-c-slider"))},cacheData:function(){this.$winWidth=this.$win.width()},bindEvents:function(){this.$body.hasClass("lr-binded")||(this.$body.addClass("lr-binded"),this.$win.on("resize",this.resize.bind(this)),this.$body.on("click",this.$formLabels,this.formLabels),this.$body.on("click touchend","#swipebox-slider .current img",function(){return!1}).on("click touchend","#swipebox-slider .current",function(){e("#swipebox-close").trigger("click")}),this.$doc.on("slide",".lets-review-c-slider",this.slideIt))},formLabels:function(){0!==t.$formLabels.length&&("on"===e(this).find("input[name=lets_review_ur_onoff]:checked").val()?t.$lrForm.slideDown(200):t.$lrForm.slideUp(200))},lightboxInit:function(){this.$body.hasClass("lr-binded")||e.prototype.swipebox&&this.$lightbox.swipebox({hideBarsDelay:0})},tooltipInit:function(){this.$winWidth<767||this.$tooltip.tipper({direction:"bottom",follow:!0})},resize:function(e,t){this.cacheData(),this.tooltipInit()},triggers:function(t,i){e.each(this.$boxWrap.find(".cb-overlay span"),function(t,i){i=e(i),i.visible(!0)&&(i.removeClass("cb-trigger-zero"),i.closest(".lets-review-box-wrap").data("format")>2?i.addClass("cb-5-trigger"):i.addClass("cb-trigger"))})},tempAni:function(t){for(var i=document.querySelectorAll(".lets-review-box-wrap .cb-overlay span"),s=new IntersectionObserver(function(t){t.forEach(function(t){if(t.intersectionRatio>0){t.target.classList.remove("cb-trigger-zero");var i=e(t.target);i.closest(".lets-review-box-wrap").data("format")>2?i.addClass("cb-5-trigger"):i.addClass("cb-trigger"),s.unobserve(t.target)}})},{threshold:[0]}),a=i.length-1;a>=0;a--)s.observe(i[a])},slideIt:function(i,s){var a=e(this);a.next().val(s.value),a.next().hasClass("lets-review-ind-crit")&&t.scoreCalc(a.next())},sliderLoaders:function(){this.$body.hasClass("lr-binded")||this.$cSliders.each(function(){var i=e(this);i.slider({min:0,max:t.dataGather.max,range:"min",step:t.dataGather.step,start:function(e,t){i.find(".ui-slider-range").css("background-color",i.data("color"))}})})},scoreCalc:function(i){var s,a=0,r=i.data("format"),o=i.closest(".lets-review-form-crits").find(".lets-review-all-crits .cb-cri-score"),n=i.closest(".lets-review-form-crits").find(".lets-review-final-score"),l=i.closest(".lets-review-form-crits").find(".lets-review-100");o.each(function(){a+=parseFloat(e(this).val())}),0===a&&n.val()>0||(s=1===parseInt(r)?Math.round(a/o.length):"on"===letsReview.doubleDecimalStars?(a/o.length).toFixed(2):Math.round(a/o.length*10)/10,isNaN(s)?(n.val(""),n.prev().slider("option",{max:t.dataGather.max,step:t.dataGather.step,value:n.val()})):(n.val(s),n.prev().slider("option",{max:t.dataGather.max,step:t.dataGather.step,value:s})),1===parseInt(r)?l.val(n.val()):2===parseInt(r)?l.val(10*n.val()):l.val(20*n.val()))}};t.init();var i,s,a,r,o,n,l,c,d,h,f,b,v,u,w,m,p,g,x,$=!1,y=e('[id^="cb-user-rating-"]'),C=Cookies.get("lets_review_user_rating");y.length&&y.each(function(){if(v=e(this),v.hasClass("lr-running"))return!0;if(u=v.closest(".lets-review-box-wrap"),f=u.data("pid"),b=u.data("uid"),!(v.hasClass("cb-rated")||C instanceof Array&&(C.indexOf(f)>-1||C.indexOf(b)>-1))){switch(v.addClass("lr-running"),u.data("format")){case 1:w=v.find(".cb-bar");break;case 2:w=v.find(".cb-bar");break;default:w=v.find(".cb-overlay")}w.on("mousemove click mouseleave mouseenter",function(t){switch(v=e(this).closest('[id^="cb-user-rating-"]'),u=v.closest(".lets-review-box-wrap"),"mouseenter"===t.type&&(i=v.find(".cb-criteria"),h=i.html(),s=v.find(".cb-criteria-score"),a=s.data("cb-score-cache"),d=s.data("cb-width-cache"),n=v.find(".cb-overlay"),c=n.offset(),r=n.find("> span"),i.html(i.data("cb-txt"))),o=Math.ceil((t.pageX-c.left)/(n.width()/100)),l=$===!0?100-o:o,l>100&&(l=100),l<1&&(l=0),u.data("format")){case 1:g=l,x=!1;break;case 2:g=Math.round(10*l)/100,x=!1;break;default:g=Math.round(l/20*10)/10,x=!0}if(u.hasClass("cb-out-of-5")?r.stop().animate({width:100-l+"%"},15):r.stop().animate({width:l+"%"},15),s.html(g),"mouseleave"!==t.type&&"click"!==t.type||(u.hasClass("cb-out-of-5")?r.stop().animate({width:100-d+"%"},200):r.stop().animate({width:d+"%"},200),s.html(a),i.html(h)),"click"===t.type)return e(this).off("mousemove click mouseleave mouseenter"),v.addClass("cb-rated cb-lr-tip-f"),e.ajax({type:"POST",data:{action:"lets_review_a_cb",letsReviewNonce:letsReview.letsReviewNonce,letsReviewScore:l,letsReviewPostID:u.data("pid"),letsReviewFormat:u.data("format"),letsReviewUID:u.data("uid")},url:letsReview.letsReviewAUrl,dataType:"json",beforeSend:function(){m=u.data("type"),p=u.find(".cb-score-box"),v.addClass("cb-voting"),3===m&&x===!1&&p.addClass("cb-fs-voting")},success:function(e){n.find("> span").css("width",e[0]+"%"),v.find(".cb-votes-count").html(e[2]),s.html(e[1]),Cookies.set("lets_review_user_rating",e[3],{expires:7}),v.removeClass("cb-voting"),3===m&&x===!1&&(p.find(".cb-final-score").html(e[1]),p.removeClass("cb-fs-voting cb-score--")),v.tipper({direction:"bottom",follow:!0})},error:function(e,t,i){console.log("cbur "+e+" :: "+t+" :: "+i)}}),!1})}})}(jQuery);